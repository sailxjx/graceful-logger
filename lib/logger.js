// Generated by CoffeeScript 1.7.1
(function() {
  var Logger, colors, formats, util,
    __bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; };

  util = require('util');

  colors = require('colors');

  formats = require('./formats');

  Logger = (function() {
    function Logger(format, options) {
      this.options = options != null ? options : {};
      this.exit = __bind(this.exit, this);
      this.debug = __bind(this.debug, this);
      this.err = __bind(this.err, this);
      this.warn = __bind(this.warn, this);
      this.info = __bind(this.info, this);
      if (typeof format === 'object') {
        this.options = format;
        format = this.options.format;
      }
      this.format(format);
      this.info.stream = process.stdout;
      this.err.stream = process.stderr;
      this.warn.stream = process.stderr;
      this.debug.stream = process.stdout;
      this.error = this.err;
      this.warning = this.warn;
    }

    Logger.prototype.format = function(format) {
      if (typeof format === 'string') {
        this._format = formats[format] || format || formats["default"];
      } else {
        this._format || (this._format = formats["default"]);
      }
      return this;
    };

    Logger.prototype.setStream = function(method, stream) {
      var all, i, _method, _ref, _ref1;
      if (method == null) {
        method = 'info';
      }
      all = ['info', 'warn', 'err', 'debug'];
      if (method === 'all') {
        method = all;
      }
      if (method instanceof Array) {
        for (i in method) {
          _method = method[i];
          if ((_ref = this[_method]) != null) {
            _ref.stream = stream;
          }
        }
      } else if (typeof method === 'string') {
        if ((_ref1 = this[method]) != null) {
          _ref1.stream = stream;
        }
      }
      return this;
    };

    Logger.prototype.getStream = function(method) {
      var _ref;
      if (method == null) {
        method = 'info';
      }
      return (_ref = this[method]) != null ? _ref.stream : void 0;
    };

    Logger.prototype._log = function() {
      var msg, raws;
      if (!this._format) {
        return false;
      }
      msg = util.format.apply(util, arguments);
      raws = msg.split('\n').map((function(_this) {
        return function(msg) {
          var raw;
          raw = _this._format.replace(/\:level/g, _this._level).replace(/\:date/g, new Date().toISOString()).replace(/\:msg/g, msg);
          if (_this._stream.isTTY) {
            raw = raw.replace(/color\((.*?)\)/g, '$1'[_this._color]);
          } else {
            raw = raw.replace(/color\((.*?)\)/g, '$1');
          }
          return raw;
        };
      })(this));
      return this._stream.write(raws.join('\n') + '\n');
    };

    Logger.prototype.info = function() {
      this._level = 'info';
      this._color = 'green';
      this._stream = this.info.stream;
      return this._log.apply(this, arguments);
    };

    Logger.prototype.warn = function() {
      this._level = 'warn';
      this._color = 'yellow';
      this._stream = this.warn.stream;
      return this._log.apply(this, arguments);
    };

    Logger.prototype.err = function() {
      this._level = 'err!';
      this._color = 'red';
      this._stream = this.err.stream;
      return this._log.apply(this, arguments);
    };

    Logger.prototype.debug = function() {
      if (!(this.options.debug || process.env.DEBUG)) {
        return false;
      }
      this._level = 'debug';
      this._color = 'cyan';
      this._stream = this.debug.stream;
      return this._log.apply(this, arguments);
    };

    Logger.prototype.exit = function(message, code) {
      if (code == null) {
        code = 1;
      }
      this.err(message);
      return process.exit(code);
    };

    Logger.prototype.mute = function() {
      this._format = formats.mute;
      return this;
    };

    return Logger;

  })();

  module.exports = Logger;

}).call(this);
